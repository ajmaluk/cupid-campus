import{c as F,u as T,a as B,r as c,j as e,A as U,m as j,s as f}from"./index-CnWK80Bc.js";import{B as P}from"./Button-Bz1vrILd.js";import{I as N,C as $}from"./Input-CTL4kd8c.js";import{I as L}from"./index-C2QYkVRQ.js";import{v as R,u as Y}from"./faceRecognition-B58rmIzU.js";import{L as v}from"./loader-circle-J2-7x2en.js";import{C as z}from"./chevron-left-DKB6BAGj.js";import{X as D}from"./x--pPRPzmo.js";import{C as O}from"./chevron-right-BkvxJ1Jm.js";const V=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],q=F("upload",V),d=["Identity","Academic","Vibe","Photos","Bio"],H=["B.Tech","M.Tech","MCA","MBA","B.Arch"],C={"B.Tech":["Computer Science","Electronics & Comm","Electrical & Electronics","Mechanical","Civil","Industrial","Applied Electronics"],"M.Tech":["Structural Eng","Control Systems","Computer Science","Thermal Science","Robotics"],MCA:["Computer Applications"],MBA:["Finance","Marketing","HR","Operations","Systems"],"B.Arch":["Architecture"]},W=["1st Year","2nd Year","3rd Year","4th Year","5th Year"];function ae({isEditing:m=!1}){const x=T(),{setCurrentUser:w}=B(),[i,u]=c.useState(0),[g,y]=c.useState(!1),[b,S]=c.useState(null),[k,A]=c.useState(!0);c.useEffect(()=>{(async()=>{const{data:{user:s}}=await f.auth.getUser();if(s){S(s.id);const{data:a}=await f.from("profiles").select("*").eq("id",s.id).single();a&&(p(o=>({...o,name:a.name||"",age:a.age?.toString()||"",gender:a.gender||"",interested_in:a.interested_in||"",department:a.department||"",major:a.major||"",year:a.year||"",interests:a.interests||[],photos:a.photos?.map(l=>l.url)||[],bio:a.bio||""})),!m&&a.name&&a.department&&a.interests&&a.interests.length>0&&u(3))}else x("/");A(!1)})()},[x,m]);const[t,p]=c.useState({name:"",age:"",gender:"",interested_in:"",department:"",major:"",year:"",interests:[],photos:[],bio:""}),n=(r,s)=>{p(r==="department"?a=>({...a,[r]:s,major:""}):a=>({...a,[r]:s}))},I=async r=>{if(r.target.files&&r.target.files[0]){const s=r.target.files[0];y(!0);try{const{isValid:a,error:o}=await R(s);if(!a){alert(o||"Face validation failed."),y(!1),r.target.value="";return}const l=await Y(s);p(h=>({...h,photos:[...h.photos,l]}))}catch(a){console.error(a),alert("Failed to upload image. Please try again.")}finally{y(!1),r.target.value=""}}},M=async()=>{if(i<d.length-1)u(r=>r+1);else{if(!b)return;const r={id:b,...t,course:`${t.department} - ${t.major}`,age:parseInt(t.age),photos:t.photos.map((s,a)=>({id:a.toString(),url:s,is_primary:a===0})),primary_photo:t.photos[0]||"",created_at:new Date().toISOString(),interests:t.interests,gender:t.gender,interested_in:t.interested_in};try{const{error:s}=await f.from("profiles").upsert(r);if(s){console.error("Error saving profile:",s),alert("Failed to save profile: "+s.message);return}w(r),x(m?"/profile":"/welcome")}catch(s){console.error("Unexpected error:",s),alert("An unexpected error occurred.")}}},_=()=>{i>0&&u(r=>r-1)},E=()=>{switch(i){case 0:return t.name&&t.age&&t.gender&&t.interested_in;case 1:return t.department&&t.major&&t.year;case 2:return t.interests.length>=3;case 3:return t.photos.length>=1;case 4:return t.bio.length>10;default:return!1}};return k?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(v,{className:"animate-spin text-primary",size:48})}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[(i>0||m)&&e.jsx("button",{onClick:i>0?_:()=>x("/profile"),className:"p-2 rounded-full bg-gray-800 text-white hover:bg-gray-700",children:e.jsx(z,{size:20})}),e.jsx("div",{className:"flex-1 flex gap-2",children:d.map((r,s)=>e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors duration-300 ${s<=i?"bg-primary":"bg-gray-800"}`},s))})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:d[i]}),e.jsxs("p",{className:"text-gray-400 mb-8",children:["Step ",i+1," of ",d.length]}),e.jsx(U,{mode:"wait",children:e.jsxs(j.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},transition:{duration:.3},className:"flex-1 space-y-6 overflow-y-auto no-scrollbar pb-4",children:[i===0&&e.jsxs(e.Fragment,{children:[e.jsx(N,{placeholder:"Full Name",value:t.name,onChange:r=>n("name",r.target.value)}),e.jsx(N,{type:"number",placeholder:"Age",value:t.age,onChange:r=>n("age",r.target.value)}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"I identify as..."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Male","Female","Non-binary","Other"].map(r=>e.jsx("button",{className:`p-4 rounded-2xl border text-sm font-medium transition-all ${t.gender===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,onClick:()=>n("gender",r),children:r},r))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"Interested in..."}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["Male","Female","Everyone"].map(r=>e.jsx("button",{className:`p-4 rounded-2xl border text-sm font-medium transition-all ${t.interested_in===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,onClick:()=>n("interested_in",r),children:r},r))})]})]}),i===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"Department / Degree"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:H.map(r=>e.jsx("button",{onClick:()=>n("department",r),className:`p-3 rounded-xl border text-sm font-medium transition-all ${t.department===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,children:r},r))})]}),t.department&&C[t.department]&&e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"Specialization / Branch"}),e.jsx("div",{className:"flex flex-col gap-2",children:C[t.department].map(r=>e.jsxs("button",{onClick:()=>n("major",r),className:`w-full p-3 rounded-xl border text-left text-sm font-medium transition-all flex justify-between items-center ${t.major===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,children:[r,t.major===r&&e.jsx($,{size:16})]},r))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"Current Year"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:W.map(r=>e.jsx("button",{onClick:()=>n("year",r),className:`p-3 rounded-xl border text-sm font-medium transition-all ${t.year===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,children:r},r))})]})]}),i===2&&e.jsx("div",{className:"space-y-8",children:Object.entries(L).map(([r,s])=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest px-1",children:r}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(a=>{const o=t.interests.includes(a);return e.jsx("button",{onClick:()=>{const l=o?t.interests.filter(h=>h!==a):[...t.interests,a];n("interests",l)},className:`px-4 py-2.5 rounded-full text-sm font-medium border transition-all active:scale-95 ${o?"bg-white text-black border-white shadow-lg shadow-white/10":"bg-gray-900/50 border-gray-800 text-gray-400 hover:border-gray-600"}`,children:a},a)})})]},r))}),i===3&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.photos.map((r,s)=>e.jsxs("div",{className:"aspect-[3/4] relative rounded-2xl overflow-hidden group shadow-lg border border-white/5",children:[e.jsx("img",{src:r,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>p(a=>({...a,photos:a.photos.filter((o,l)=>l!==s)})),className:"absolute top-2 right-2 p-1.5 bg-black/60 backdrop-blur-md rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(D,{size:14})}),s===0&&e.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-primary/90 rounded-md text-[10px] font-bold text-white uppercase tracking-wider",children:"Main"})]},s)),t.photos.length<6&&e.jsxs("label",{className:"aspect-[3/4] rounded-2xl border-2 border-dashed border-gray-800 flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:border-primary/50 hover:bg-primary/5 hover:text-primary transition-all bg-gray-900/30",children:[g?e.jsx(v,{className:"animate-spin mb-2 text-primary"}):e.jsx(q,{className:"mb-2"}),e.jsx("span",{className:"text-xs font-medium",children:g?"Uploading...":"Add Photo"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:I,disabled:g})]})]}),i===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{placeholder:"Write a short bio about yourself... What makes you tick?",className:"w-full h-48 bg-gray-900 border border-gray-800 rounded-3xl p-6 text-white text-lg placeholder:text-gray-600 focus:outline-none focus:border-primary/50 resize-none leading-relaxed",value:t.bio,onChange:r=>n("bio",r.target.value),maxLength:300}),e.jsxs("div",{className:"absolute bottom-4 right-6 text-xs font-medium text-gray-500",children:[t.bio.length," / 300"]})]}),e.jsx("p",{className:"text-sm text-gray-500 px-2",children:"ðŸ’¡ Tip: Mention your favorite spot on campus or your go-to canteen order!"})]})]},i)}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-800",children:e.jsxs(P,{className:"w-full h-14 text-lg font-bold rounded-2xl",onClick:M,disabled:!E()||g,children:[i===d.length-1?m?"Save Changes":"Finish Profile":"Continue",i<d.length-1&&e.jsx(O,{className:"ml-2"})]})})]})]})}export{ae as default};
