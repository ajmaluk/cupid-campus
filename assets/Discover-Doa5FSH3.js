import{i as re,b as E,d as ie,r as m,M as le,e as ne,f as oe,h as ce,k as $,c as w,j as e,A as U,m as u,a as W,S as B,u as de,s as C}from"./index-CnWK80Bc.js";import{a as Y,s as me}from"./matching-CmQnGECg.js";import{B as F}from"./Button-Bz1vrILd.js";import{S as xe}from"./shield-DBBBEfFh.js";import{X as ue}from"./x--pPRPzmo.js";import{L as he}from"./loader-circle-J2-7x2en.js";import"./index-C2QYkVRQ.js";function pe(...s){const t=!Array.isArray(s[0]),a=t?0:-1,i=s[0+a],l=s[1+a],c=s[2+a],n=s[3+a],h=re(l,c,n);return t?h(i):h}function K(s){const t=E(()=>ie(s)),{isStatic:a}=m.useContext(le);if(a){const[,i]=m.useState(s);m.useEffect(()=>t.on("change",i),[])}return t}function X(s,t){const a=K(t()),i=()=>a.set(t());return i(),ne(()=>{const l=()=>ce.preRender(i,!1,!0),c=s.map(n=>n.on("change",l));return()=>{c.forEach(n=>n()),oe(i)}}),a}function fe(s){$.current=[],s();const t=X($.current,s);return $.current=void 0,t}function z(s,t,a,i){if(typeof s=="function")return fe(s);if(a!==void 0&&!Array.isArray(a)&&typeof t!="function")return ye(s,t,a,i);const n=typeof t=="function"?t:pe(t,a,i),h=Array.isArray(s)?H(s,n):H([s],([x])=>n(x)),p=Array.isArray(s)?void 0:s.accelerate;return p&&!p.isTransformed&&typeof t!="function"&&Array.isArray(a)&&i?.clamp!==!1&&(h.accelerate={...p,times:t,keyframes:a,isTransformed:!0}),h}function H(s,t){const a=E(()=>[]);return X(s,()=>{a.length=0;const i=s.length;for(let l=0;l<i;l++)a[l]=s[l].get();return t(a)})}function ye(s,t,a,i){const l=E(()=>Object.keys(a)),c=E(()=>({}));for(const n of l)c[n]=z(s,t,a[n],i);return c}const be=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ge=w("circle-alert",be);const je=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],we=w("ellipsis",je);const Ne=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ve=w("image",Ne);const ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],_e=w("info",ke);const Se=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ce=w("rotate-ccw",Se);const ze=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Me=w("triangle-alert",ze);const Ae=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Ie=w("zap",Ae),Ee=["Inappropriate Photos","Spam or Scam","Harassment","Fake Profile","Underage","Other"],Pe=({isOpen:s,onClose:t,onReport:a,userName:i})=>{const[l,c]=m.useState(null);return e.jsx(U,{children:s&&e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-6 backdrop-blur-sm",onClick:t,children:e.jsxs(u.div,{initial:{scale:.95,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:20},className:"w-full max-w-sm bg-gray-900 border border-gray-800 rounded-3xl p-6 relative overflow-hidden",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(xe,{className:"text-red-500",size:20})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold text-white",children:["Report ",i]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Help keep our campus safe."})]}),e.jsx("button",{onClick:t,className:"absolute top-6 right-6 text-gray-500 hover:text-white",children:e.jsx(ue,{size:20})})]}),e.jsx("div",{className:"space-y-2 mb-6",children:Ee.map(n=>e.jsx("button",{onClick:()=>c(n),className:`w-full text-left p-3 rounded-xl text-sm font-medium transition-all ${l===n?"bg-red-500 text-white shadow-lg shadow-red-500/20":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:n},n))}),e.jsxs("div",{className:"flex gap-2 p-3 bg-yellow-500/10 rounded-xl mb-6",children:[e.jsx(Me,{className:"text-yellow-500 shrink-0",size:16}),e.jsxs("p",{className:"text-xs text-yellow-500/80 leading-relaxed",children:["This will hide ",i," from your feed and our team will review the report within 24 hours."]})]}),e.jsx(F,{className:"w-full bg-red-500 hover:bg-red-600 text-white",disabled:!l,onClick:()=>l&&a(l),children:"Submit Report"})]})})})},O=({src:s,alt:t})=>{const[a,i]=m.useState(!1);return e.jsxs("div",{className:"relative w-full h-full bg-gray-800",children:[!a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center animate-pulse",children:e.jsx(ve,{className:"text-gray-600 w-12 h-12"})}),e.jsx("img",{src:s,alt:t,className:`w-full h-full object-cover transition-opacity duration-500 ${a?"opacity-100":"opacity-0"}`,draggable:!1,onLoad:()=>i(!0)})]})},Le=m.memo(({profile:s,onSwipe:t,active:a})=>{const[i,l]=m.useState(!1),[c,n]=m.useState(!1),{reportUser:h,currentUser:p}=W(),x=m.useMemo(()=>p?Y(p,s):null,[p,s]),f=K(0),P=z(f,[-200,200],[-15,15]),L=z(f,[-200,-100,0,100,200],[.5,1,1,1,.5]),N=z(f,[10,150],[0,1]),M=z(f,[-10,-150],[0,1]),R=(o,g)=>{g.offset.x>100?t("right"):g.offset.x<-100&&t("left")},k=o=>{h(s.id,o),n(!1),t("left")},A=a?1:.95,I=a?0:10;return s?e.jsxs(e.Fragment,{children:[e.jsxs(u.div,{style:{x:a?f:0,rotate:a?P:0,opacity:a?L:1,zIndex:a?10:0},drag:a?"x":!1,dragConstraints:{left:0,right:0},onDragEnd:R,className:`absolute inset-0 w-full h-full rounded-3xl overflow-hidden shadow-2xl bg-gray-900 border border-white/5 ${a?"cursor-grab active:cursor-grabbing":""}`,initial:{scale:.9,y:20,opacity:0},animate:{scale:i?1:A,y:i?0:I,opacity:1},exit:{scale:1.05,opacity:0},transition:{duration:.3},children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx(O,{src:s.primary_photo,alt:s.name}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black"})]}),s.is_admin_recommended&&e.jsxs(u.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"absolute top-6 left-1/2 -translate-x-1/2 z-30 bg-gradient-to-r from-pink-500 to-purple-600 px-4 py-1.5 rounded-full shadow-lg border border-white/20 flex items-center gap-2",children:[e.jsx(B,{size:16,className:"text-yellow-300 fill-yellow-300"}),e.jsx("span",{className:"text-xs font-bold text-white uppercase tracking-wider",children:"Cupid's Pick"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(u.div,{style:{opacity:N},className:"absolute top-8 left-8 -rotate-12 border-4 border-green-500 rounded-lg px-4 py-1 z-20",children:e.jsx("span",{className:"text-green-500 font-bold text-4xl uppercase tracking-widest",children:"Like"})}),e.jsx(u.div,{style:{opacity:M},className:"absolute top-8 right-8 rotate-12 border-4 border-red-500 rounded-lg px-4 py-1 z-20",children:e.jsx("span",{className:"text-red-500 font-bold text-4xl uppercase tracking-widest",children:"Nope"})})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),n(!0)},className:"absolute top-6 right-6 p-2 bg-black/20 backdrop-blur-md rounded-full text-white/70 hover:text-white hover:bg-black/40 transition-colors z-40",children:e.jsx(we,{size:24})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 text-white z-10 select-none",children:[e.jsxs("div",{className:"flex items-end justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold flex items-baseline gap-2",children:[s.name,e.jsx("span",{className:"text-xl font-normal opacity-90",children:s.age})]}),e.jsx("p",{className:"text-gray-300 font-medium",children:s.course}),x&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("div",{className:`px-2 py-0.5 rounded-md border text-xs font-bold flex items-center gap-1 ${x.percentage>=80?"bg-green-500/20 border-green-500 text-green-400":x.percentage>=60?"bg-yellow-500/20 border-yellow-500 text-yellow-400":"bg-gray-500/20 border-gray-500 text-gray-400"}`,children:[e.jsx(Ie,{size:10,className:"fill-current"}),x.percentage,"% Match"]}),x.academicSynergy&&e.jsx("div",{className:"px-2 py-0.5 rounded-md bg-purple-500/20 border border-purple-500 text-purple-300 text-xs font-bold",children:x.academicSynergy})]})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),l(!i)},className:"p-2 bg-white/10 backdrop-blur-md rounded-full hover:bg-white/20 transition-colors",children:e.jsx(_e,{size:24})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.interests.slice(0,3).map(o=>e.jsx("span",{className:"text-xs font-medium bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full",children:o},o)),s.interests.length>3&&e.jsxs("span",{className:"text-xs font-medium bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full",children:["+",s.interests.length-3]})]}),i&&e.jsxs(u.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},className:"space-y-4 pt-4 border-t border-white/10",children:[e.jsx("p",{className:"text-sm leading-relaxed text-gray-200",children:s.bio}),x&&x.vibeTags.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-bold uppercase tracking-wider text-green-400 mb-2 flex items-center gap-1",children:[e.jsx(B,{size:12})," Why you match"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.vibeTags.map(o=>e.jsx("span",{className:"text-xs font-bold text-green-300 bg-green-900/30 border border-green-500/30 px-2 py-1 rounded-md",children:o},o))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-gray-400 mb-2",children:"Interests"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.interests.map(o=>e.jsx("span",{className:"text-xs font-medium bg-white/10 px-3 py-1 rounded-full border border-white/10",children:o},o))})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4",children:s.photos.slice(1).map(o=>e.jsx("div",{className:"aspect-[3/4] rounded-lg overflow-hidden bg-gray-800",children:e.jsx(O,{src:o.url,alt:""})},o.id))})]})]})]}),e.jsx(Pe,{isOpen:c,onClose:()=>n(!1),onReport:k,userName:s.name})]}):null}),Re=({isOpen:s,onClose:t,matchedProfile:a,currentUser:i,analysis:l})=>e.jsx(U,{children:s&&e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 p-6",children:e.jsxs("div",{className:"w-full max-w-sm text-center",children:[e.jsxs(u.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,type:"spring"},className:"mb-8",children:[e.jsx("h1",{className:"text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-500 italic",children:"It's a Match!"}),l&&e.jsx("div",{className:"mt-2 inline-block px-4 py-1 rounded-full bg-white/10 border border-white/20",children:e.jsxs("span",{className:"text-green-400 font-bold",children:[l.percentage,"% Compatible"]})})]}),e.jsxs("div",{className:"flex justify-center items-center gap-4 mb-8 relative h-40",children:[e.jsx(u.div,{initial:{x:-100,rotate:-20,opacity:0},animate:{x:-20,rotate:-10,opacity:1},transition:{delay:.4},className:"w-32 h-32 rounded-full border-4 border-white overflow-hidden absolute left-1/2 -ml-16 shadow-2xl",children:e.jsx("img",{src:i.primary_photo,className:"w-full h-full object-cover"})}),e.jsx(u.div,{initial:{x:100,rotate:20,opacity:0},animate:{x:20,rotate:10,opacity:1},transition:{delay:.4},className:"w-32 h-32 rounded-full border-4 border-white overflow-hidden absolute right-1/2 -mr-16 shadow-2xl",children:e.jsx("img",{src:a.primary_photo,className:"w-full h-full object-cover"})})]}),e.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"text-white mb-8 space-y-4",children:[e.jsxs("p",{className:"text-lg",children:["You and ",a.name," have similar vibes!"]}),l&&l.vibeTags.length>0&&e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:l.vibeTags.slice(0,3).map(c=>e.jsx("span",{className:"text-xs bg-purple-500/20 text-purple-200 px-3 py-1 rounded-full border border-purple-500/30",children:c},c))})]}),e.jsxs(u.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.8},className:"space-y-3",children:[e.jsx(F,{className:"w-full",onClick:t,children:"Send a Message"}),e.jsx(F,{variant:"ghost",className:"w-full",onClick:t,children:"Keep Swiping"})]})]})})});function Be(){const s=de(),{currentUser:t,potentialMatches:a,setPotentialMatches:i,removePotentialMatch:l,matches:c,setMatches:n,recommendations:h,blockedUsers:p,swipes:x,addSwipe:f,removeSwipe:P,removeAllSwipes:L}=W(),[N,M]=m.useState(null),[R,k]=m.useState(a.length===0),[A,I]=m.useState(""),[o,g]=m.useState(null),v=m.useRef(null);m.useEffect(()=>{if(!t){s("/");return}const y=async()=>{k(!0),I("");const{data:d,error:j}=await C.from("swipes").select("swiped_id").eq("swiper_id",t.id);j&&console.error("Error syncing swipes:",j);const q=d?.map(r=>r.swiped_id)||[];let _=C.from("profiles").select("*").neq("id",t.id);t.interested_in!=="Everyone"&&(_=_.eq("gender",t.interested_in));const{data:b,error:D}=await _;if(D){console.error("Error fetching profiles:",D),I("Failed to load profiles. Please check your connection."),k(!1);return}const J=c.map(r=>r.user2===t.id?r.user1:r.user2),Q=p,ee=[...new Set([...x,...q])];let S=(b||[]).map(r=>({...r,interests:r.interests||[],photos:r.photos||[]}));S=S.filter(r=>!J.includes(r.id)&&!Q.includes(r.id)&&!ee.includes(r.id)&&(t.interested_in==="Everyone"||r.gender===t.interested_in)&&(r.interested_in==="Everyone"||r.interested_in===t.gender));const V=h.filter(r=>r.target_user_id===t.id),te=V.map(r=>r.recommended_user_id),se=V.filter(r=>r.type==="soulmate").map(r=>r.recommended_user_id);S=S.map(r=>({...r,is_admin_recommended:te.includes(r.id),is_soulmate:se.includes(r.id)}));const T=me(t,S),ae=[...T.filter(r=>r.is_soulmate),...T.filter(r=>r.is_admin_recommended&&!r.is_soulmate),...T.filter(r=>!r.is_admin_recommended)];i(ae),k(!1)};a.length===0&&y()},[t,a.length,s,i,h,c,p,x]);const Z=m.useCallback(async(y,d)=>{if(!t)return;g(d),v.current&&clearTimeout(v.current),v.current=window.setTimeout(()=>{g(null)},4e3),l(d.id),f(d.id);const{error:j}=await C.from("swipes").insert({swiper_id:t.id,swiped_id:d.id,liked:y==="right"});if(j&&console.error("Swipe error:",j),y==="right"){const{data:q}=await C.from("swipes").select("*").eq("swiper_id",d.id).eq("swiped_id",t.id).eq("liked",!0).maybeSingle(),_=d.is_admin_recommended||d.is_soulmate;if((q||_)&&t){const b=Y(t,d);d.is_soulmate&&(b.score=100,b.percentage=100,b.vibeTags.unshift("Soul Mate âœ¨")),await C.from("matches").insert({user1:t.id,user2:d.id,compatibility_score:b.score}),n([...c,{id:Date.now(),user1:t.id,user2:d.id,compatibility_score:b.score,created_at:new Date().toISOString(),profile:d}]),M({profile:d,analysis:b}),g(null)}}},[t,c,l,n,f]),G=()=>{o&&(i([o,...a]),P(o.id),g(null),v.current&&clearTimeout(v.current))};return t?e.jsxs("div",{className:"min-h-screen bg-background relative overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"h-20 flex items-center justify-between px-8 z-10 bg-gradient-to-b from-background via-background/95 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-3 md:hidden",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ðŸ’˜"})}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-purple-500 bg-clip-text text-transparent",children:"Cupid Campus"})]}),e.jsxs("div",{className:"flex items-center gap-4 ml-auto",children:[e.jsxs("div",{className:"hidden md:flex flex-col text-right",children:[e.jsx("span",{className:"text-white font-bold",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400",children:t.major})]}),e.jsx("div",{className:"w-12 h-12 rounded-full p-[2px] bg-gradient-to-tr from-primary to-purple-600",children:e.jsx("img",{src:t.primary_photo,className:"w-full h-full rounded-full object-cover border-2 border-background"})})]})]}),e.jsx("div",{className:"flex-1 relative max-w-md mx-auto w-full mb-24 mt-8 px-4 md:px-0",children:R?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center p-8",children:[e.jsx(he,{size:48,className:"animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-gray-400 animate-pulse",children:"Finding matches near you..."})]}):A?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center p-8",children:[e.jsx("div",{className:"w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(ge,{size:40,className:"text-red-500"})}),e.jsx("p",{className:"text-lg font-bold text-white mb-2",children:"Oops!"}),e.jsx("p",{className:"text-gray-400 mb-6",children:A}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-white text-black rounded-full font-bold hover:bg-gray-200 transition-colors",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{children:a.slice(0,2).map((y,d)=>e.jsx(Le,{profile:y,active:d===0,onSwipe:j=>Z(j,y)},y.id)).reverse()}),a.length===0&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center p-8 text-gray-500",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-800 rounded-full flex items-center justify-center mb-4 animate-pulse",children:e.jsx("span",{className:"text-4xl",children:"ðŸ”"})}),e.jsx("p",{className:"text-lg",children:"No more profiles nearby."}),e.jsx("p",{className:"text-sm mt-2",children:"Check back later!"}),e.jsx("button",{onClick:()=>{L(),i([])},className:"mt-6 px-6 py-2 bg-gray-800 rounded-full text-sm hover:bg-gray-700 transition-colors border border-gray-700",children:"Reset Swipes & Refresh"})]}),o&&a.length>0&&e.jsx("button",{onClick:G,className:"absolute bottom-4 left-4 z-20 p-3 bg-gray-800/80 backdrop-blur-md rounded-full text-yellow-500 shadow-lg border border-yellow-500/20 hover:bg-gray-700 transition-all active:scale-95",children:e.jsx(Ce,{size:20})})]})}),N&&e.jsx(Re,{isOpen:!!N,onClose:()=>M(null),matchedProfile:N.profile,currentUser:t,analysis:N.analysis})]}):null}export{Be as default};
