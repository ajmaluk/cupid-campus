import{c as l,n as j,u as v,a as w,r as n,s as c,j as e}from"./index-Dhzu-lA5.js";import{P as N}from"./PageTransition-K6c_Ev3n.js";const k=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],_=l("arrow-left",k);const E=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],S=l("ellipsis-vertical",E);const $=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],T=l("send",$);const z=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],M=l("smile",z);function D(){const{id:t}=j(),x=v(),{matches:p,currentUser:d}=w(),[m,h]=n.useState([]),[r,g]=n.useState(""),u=n.useRef(null),i=p.find(s=>s.id.toString()===t)?.profile,f=()=>{u.current?.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{if(!t)return;(async()=>{const{data:o}=await c.from("messages").select("*").eq("match_id",t).order("created_at",{ascending:!0});o&&h(o)})();const a=c.channel(`chat:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`match_id=eq.${t}`},o=>{h(b=>[...b,o.new])}).subscribe();return()=>{c.removeChannel(a)}},[t]),n.useEffect(()=>{f()},[m]);const y=async()=>{if(!r.trim()||!d)return;const{error:s}=await c.from("messages").insert({match_id:Number(t),sender_id:d.id,content:r});if(s){console.error("Error sending message:",s);return}g("")};return i?e.jsx(N,{children:e.jsxs("div",{className:"flex flex-col h-full bg-background relative",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 border-b border-white/5 bg-gray-900/80 backdrop-blur-md sticky top-0 z-10 shadow-sm",children:[e.jsx("button",{onClick:()=>x("/chat"),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(_,{size:24})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3 cursor-pointer",onClick:()=>x("/profile/"+i.id),children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i.primary_photo,className:"w-10 h-10 rounded-full object-cover ring-2 ring-gray-800"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-white leading-none mb-0.5",children:i.name}),e.jsx("span",{className:"text-xs text-green-500 font-medium",children:"Online now"})]})]}),e.jsx("button",{className:"text-gray-400 hover:text-white",children:e.jsx(S,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx("div",{className:"text-center text-xs text-gray-500 my-4",children:"Today"}),m.map(s=>{const a=s.sender_id===d?.id;return e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-3 shadow-sm ${a?"bg-primary text-white rounded-br-none":"bg-gray-800 text-gray-200 rounded-bl-none"}`,children:[e.jsx("p",{className:"text-sm leading-relaxed",children:s.content}),e.jsx("span",{className:`text-[10px] block mt-1 opacity-70 ${a?"text-primary-foreground":"text-gray-400"}`,children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},s.id)}),e.jsx("div",{ref:u})]}),e.jsx("div",{className:"p-4 bg-gray-900/60 border-t border-white/5 backdrop-blur-xl pb-safe",children:e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/80 rounded-full px-4 py-2 border border-gray-700/50 focus-within:border-primary/50 focus-within:bg-gray-800 transition-all shadow-lg",children:[e.jsx("button",{className:"text-gray-400 hover:text-yellow-400 transition-colors p-1",children:e.jsx(M,{size:24})}),e.jsx("input",{type:"text",className:"flex-1 bg-transparent border-none outline-none text-white placeholder:text-gray-500 h-10",placeholder:"Type a message...",value:r,onChange:s=>g(s.target.value),onKeyDown:s=>s.key==="Enter"&&y()}),e.jsx("button",{onClick:y,disabled:!r.trim(),className:`p-2 rounded-full transition-all ${r.trim()?"bg-primary text-white shadow-lg shadow-primary/20 scale-100":"bg-gray-700 text-gray-500 scale-90"}`,children:e.jsx(T,{size:18})})]})})]})}):null}export{D as default};
