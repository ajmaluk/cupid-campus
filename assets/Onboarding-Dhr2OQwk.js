import{c as M,u as _,a as E,r as m,j as e,A as F,m as j,s as y}from"./index-Dhzu-lA5.js";import{B as T}from"./Button-Kzv1x8oz.js";import{I as v,C as B}from"./Input-BqxHjzWa.js";import{I as U}from"./index-C2QYkVRQ.js";import{v as P,u as $}from"./faceRecognition-B58rmIzU.js";import{C as R}from"./chevron-left-D9YHv3Kq.js";import{X as Y}from"./x-CgtbP0te.js";import{L as D}from"./loader-circle-B-5vLa0N.js";import{C as L}from"./chevron-right-B8nfOezA.js";const O=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],z=M("upload",O),c=["Identity","Academic","Vibe","Photos","Bio"],V=["B.Tech","M.Tech","MCA","MBA","B.Arch"],N={"B.Tech":["Computer Science","Electronics & Comm","Electrical & Electronics","Mechanical","Civil","Industrial","Applied Electronics"],"M.Tech":["Structural Eng","Control Systems","Computer Science","Thermal Science","Robotics"],MCA:["Computer Applications"],MBA:["Finance","Marketing","HR","Operations","Systems"],"B.Arch":["Architecture"]},q=["1st Year","2nd Year","3rd Year","4th Year","5th Year"];function re({isEditing:h=!1}){const p=_(),{setCurrentUser:C}=E(),[i,b]=m.useState(0),[x,u]=m.useState(!1),[f,w]=m.useState(null);m.useEffect(()=>{(async()=>{const{data:{user:s}}=await y.auth.getUser();if(s){w(s.id);const{data:a}=await y.from("profiles").select("*").eq("id",s.id).single();a&&d(n=>({...n,name:a.name||"",age:a.age?.toString()||"",gender:a.gender||"",interested_in:a.interested_in||"",department:a.department||"",major:a.major||"",year:a.year||"",interests:a.interests||[],photos:a.photos?.map(l=>l.url)||[],bio:a.bio||""}))}else p("/")})()},[p]);const[t,d]=m.useState({name:"",age:"",gender:"",interested_in:"",department:"",major:"",year:"",interests:[],photos:[],bio:""}),o=(r,s)=>{d(r==="department"?a=>({...a,[r]:s,major:""}):a=>({...a,[r]:s}))},S=async r=>{if(r.target.files&&r.target.files[0]){const s=r.target.files[0];u(!0);try{const{isValid:a,error:n}=await P(s);if(!a){alert(n||"Face validation failed."),u(!1),r.target.value="";return}const l=await $(s);d(g=>({...g,photos:[...g.photos,l]}))}catch(a){console.error(a),alert("Failed to upload image. Please try again.")}finally{u(!1),r.target.value=""}}},k=async()=>{if(i<c.length-1)b(r=>r+1);else{if(!f)return;const r={id:f,...t,course:`${t.department} - ${t.major}`,age:parseInt(t.age),photos:t.photos.map((s,a)=>({id:a.toString(),url:s,is_primary:a===0})),primary_photo:t.photos[0]||"",created_at:new Date().toISOString(),interests:t.interests,gender:t.gender,interested_in:t.interested_in};try{const{error:s}=await y.from("profiles").upsert(r);if(s){console.error("Error saving profile:",s),alert("Failed to save profile: "+s.message);return}C(r),p(h?"/profile":"/welcome")}catch(s){console.error("Unexpected error:",s),alert("An unexpected error occurred.")}}},A=()=>{i>0&&b(r=>r-1)},I=()=>{switch(i){case 0:return t.name&&t.age&&t.gender&&t.interested_in;case 1:return t.department&&t.major&&t.year;case 2:return t.interests.length>=3;case 3:return t.photos.length>=1;case 4:return t.bio.length>10;default:return!1}};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[(i>0||h)&&e.jsx("button",{onClick:i>0?A:()=>p("/profile"),className:"p-2 rounded-full bg-gray-800 text-white hover:bg-gray-700",children:e.jsx(R,{size:20})}),e.jsx("div",{className:"flex-1 flex gap-2",children:c.map((r,s)=>e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors duration-300 ${s<=i?"bg-primary":"bg-gray-800"}`},s))})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:c[i]}),e.jsxs("p",{className:"text-gray-400 mb-8",children:["Step ",i+1," of ",c.length]}),e.jsx(F,{mode:"wait",children:e.jsxs(j.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},transition:{duration:.3},className:"flex-1 space-y-6 overflow-y-auto no-scrollbar pb-4",children:[i===0&&e.jsxs(e.Fragment,{children:[e.jsx(v,{placeholder:"Full Name",value:t.name,onChange:r=>o("name",r.target.value)}),e.jsx(v,{type:"number",placeholder:"Age",value:t.age,onChange:r=>o("age",r.target.value)}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"I identify as..."}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Male","Female","Non-binary","Other"].map(r=>e.jsx("button",{className:`p-4 rounded-2xl border text-sm font-medium transition-all ${t.gender===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,onClick:()=>o("gender",r),children:r},r))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"Interested in..."}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["Male","Female","Everyone"].map(r=>e.jsx("button",{className:`p-4 rounded-2xl border text-sm font-medium transition-all ${t.interested_in===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,onClick:()=>o("interested_in",r),children:r},r))})]})]}),i===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"Department / Degree"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:V.map(r=>e.jsx("button",{onClick:()=>o("department",r),className:`p-3 rounded-xl border text-sm font-medium transition-all ${t.department===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,children:r},r))})]}),t.department&&N[t.department]&&e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"Specialization / Branch"}),e.jsx("div",{className:"flex flex-col gap-2",children:N[t.department].map(r=>e.jsxs("button",{onClick:()=>o("major",r),className:`w-full p-3 rounded-xl border text-left text-sm font-medium transition-all flex justify-between items-center ${t.major===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,children:[r,t.major===r&&e.jsx(B,{size:16})]},r))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-400 font-medium",children:"Current Year"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:q.map(r=>e.jsx("button",{onClick:()=>o("year",r),className:`p-3 rounded-xl border text-sm font-medium transition-all ${t.year===r?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-800 text-gray-400"}`,children:r},r))})]})]}),i===2&&e.jsx("div",{className:"space-y-8",children:Object.entries(U).map(([r,s])=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest px-1",children:r}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(a=>{const n=t.interests.includes(a);return e.jsx("button",{onClick:()=>{const l=n?t.interests.filter(g=>g!==a):[...t.interests,a];o("interests",l)},className:`px-4 py-2.5 rounded-full text-sm font-medium border transition-all active:scale-95 ${n?"bg-white text-black border-white shadow-lg shadow-white/10":"bg-gray-900/50 border-gray-800 text-gray-400 hover:border-gray-600"}`,children:a},a)})})]},r))}),i===3&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.photos.map((r,s)=>e.jsxs("div",{className:"aspect-[3/4] relative rounded-2xl overflow-hidden group shadow-lg border border-white/5",children:[e.jsx("img",{src:r,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>d(a=>({...a,photos:a.photos.filter((n,l)=>l!==s)})),className:"absolute top-2 right-2 p-1.5 bg-black/60 backdrop-blur-md rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Y,{size:14})}),s===0&&e.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-primary/90 rounded-md text-[10px] font-bold text-white uppercase tracking-wider",children:"Main"})]},s)),t.photos.length<6&&e.jsxs("label",{className:"aspect-[3/4] rounded-2xl border-2 border-dashed border-gray-800 flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:border-primary/50 hover:bg-primary/5 hover:text-primary transition-all bg-gray-900/30",children:[x?e.jsx(D,{className:"animate-spin mb-2 text-primary"}):e.jsx(z,{className:"mb-2"}),e.jsx("span",{className:"text-xs font-medium",children:x?"Uploading...":"Add Photo"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:S,disabled:x})]})]}),i===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{placeholder:"Write a short bio about yourself... What makes you tick?",className:"w-full h-48 bg-gray-900 border border-gray-800 rounded-3xl p-6 text-white text-lg placeholder:text-gray-600 focus:outline-none focus:border-primary/50 resize-none leading-relaxed",value:t.bio,onChange:r=>o("bio",r.target.value),maxLength:300}),e.jsxs("div",{className:"absolute bottom-4 right-6 text-xs font-medium text-gray-500",children:[t.bio.length," / 300"]})]}),e.jsx("p",{className:"text-sm text-gray-500 px-2",children:"ðŸ’¡ Tip: Mention your favorite spot on campus or your go-to canteen order!"})]})]},i)}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-800",children:e.jsxs(T,{className:"w-full h-14 text-lg font-bold rounded-2xl",onClick:k,disabled:!I()||x,children:[i===c.length-1?h?"Save Changes":"Finish Profile":"Continue",i<c.length-1&&e.jsx(L,{className:"ml-2"})]})})]})]})}export{re as default};
